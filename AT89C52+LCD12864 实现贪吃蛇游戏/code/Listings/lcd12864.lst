C51 COMPILER V9.59.0.0   LCD12864                                                          12/09/2019 23:55:14 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN .\Objects\lcd12864.obj
COMPILER INVOKED BY: D:\Keil C51\C51\BIN\C51.EXE lcd12864.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\lcd12864.lst) OBJECT(.\Objects\lcd12864.obj)

line level    source

   1          #include "lcd12864.h"
   2          #include "intrins.h"
   3          
   4          void Delay_1ms(unsigned int n){
   5   1          unsigned char i;
   6   1              unsigned char cnt = 0;
   7   1          for(i=1; i<=n; i++)
   8   1                      while(cnt < 250) 
   9   1                              cnt++;
  10   1      }
  11          
  12          //Á≠âÂæÖÂøôÊ†áÂøóÂáΩÊï∞
  13          void LCD_Check_Busy(){
  14   1              LCD_DATA = 0xff;
  15   1              LCD_EN = 0;                             //Á°Æ‰øù‰ΩøËÉΩÁ´Ø‰∏∫‰ΩéÁîµÂπ≥
  16   1              LCD_RS = 0;                             //1‰∏∫Êï∞ÊçÆÔºå0‰∏∫ÂëΩ‰ª§
  17   1              LCD_RW = 1;                             //1‰∏∫‰ªé12864ËØªÂèñÔºå0‰∏∫Âêë12864ÂÜôÂÖ•
  18   1              LCD_EN = 1;
  19   1              
  20   1              while(LCD_DATA & 0x80); //ÂøôÁä∂ÊÄÅÊ£ÄÊµã
  21   1              LCD_EN = 0;
  22   1      }
  23          
  24          //Âπ∂Âè£Ê®°ÂºèÂàùÂßãÂåñÂáΩÊï∞
  25          void LCD_Init(){
  26   1              LCD_Write(MODE_CMD, 0x30);      //Âü∫Êú¨Êåá‰ª§ÈõÜ,8‰ΩçÂπ∂Ë°å
  27   1              LCD_Write(MODE_CMD, 0x01);      //Ê∏ÖÈô§ÊòæÁ§∫DDRAM
  28   1              LCD_Write(MODE_CMD, 0x06);      //ÂêØÂßãÁÇπËÆæÂÆöÔºöÂÖâÊ†áÂè≥Áßª
  29   1              LCD_Write(MODE_CMD, 0x0C);      //ÊòæÁ§∫Áä∂ÊÄÅÂºÄÂÖ≥ÔºöÊï¥‰ΩìÊòæÁ§∫ÂºÄÔºåÂÖâÊ†áÊòæÁ§∫ÂÖ≥ÔºåÂÖâÊ†áÊòæÁ§∫ÂèçÁôΩÂ
             -Ö≥
  30   1              LCD_Write(MODE_CMD, 0x02);      //Âú∞ÂùÄÂΩíÈõ∂
  31   1      }
  32          
  33          //Âπ∂Âè£ÂÜôÂÖ•ÂáΩÊï∞
  34          void LCD_Write(unsigned char Write_Mode, unsigned char Data_Command){
  35   1      /*
  36   1              LCD_Check_Busy();
  37   1              LCD_EN = 0;                                     //Á°Æ‰øù‰ΩøËÉΩÁ´Ø‰∏∫‰ΩéÁîµÂπ≥
  38   1              LCD_RS = Write_Mode;            //1‰∏∫ÂÜôÂÖ•Êï∞ÊçÆÔºå0‰∏∫ÂÜôÂÖ•ÂëΩ‰ª§
  39   1              LCD_RW = 0;                                     //1‰∏∫‰ªé12864ËØªÂèñÔºå0‰∏∫Âêë12864ÂÜôÂÖ•
  40   1              
  41   1              LCD_DATA = Data_Command;
  42   1              LCD_EN = 1;
  43   1              Delay_1ms(1);
  44   1              LCD_EN = 0;
  45   1      */
  46   1              LCD_Check_Busy();
  47   1              LCD_RS = Write_Mode;
  48   1              LCD_RW = 0;
  49   1              LCD_EN = 0;
  50   1              LCD_DATA = Data_Command;
  51   1              _nop_();
  52   1              _nop_();
  53   1              LCD_EN = 1;
C51 COMPILER V9.59.0.0   LCD12864                                                          12/09/2019 23:55:14 PAGE 2   

  54   1              _nop_();
  55   1              _nop_();
  56   1              LCD_EN = 0;
  57   1              LCD_RW = 1;
  58   1              LCD_RS = 1;
  59   1      
  60   1      }
  61          
  62          //ËØªÂèñRAM‰∏≠Áõ∏Â∫îÊï∞ÊçÆ,1‰∏∫ËØªÂèñÊï∞ÊçÆ,0‰∏∫ËØªÂèñÂëΩ‰ª§(Âç≥ÂøôÊ†áÂøó)
  63          unsigned char LCD_Read(unsigned char Read_Mode){
  64   1              unsigned char Data_Command;
  65   1              LCD_Check_Busy();                               //Á≠âÂæÖÂøôÊ†áÂøóÂáΩÊï∞
  66   1              LCD_DATA = 0xff;                                //Áî±‰∫éIOÂè£ÊòØÂáÜÂèåÂêë,ÊâÄ‰ª•ËØªÂèñ‰πãÂâçÂÖàÂÜôÂÖ•È´òÁîµÂπ≥
  67   1              LCD_RS = Read_Mode;                             //1‰∏∫ËØªÂèñÊï∞ÊçÆÔºå0‰∏∫ËØªÂèñÂëΩ‰ª§,ËØªÂëΩ‰ª§ËØªÁöÑÊòØÂøôÊ†áÂøóÂíåÊ≠§Êó∂ÂÖâÊ†áÁö
             -Ñ‰ΩçÁΩÆ
  68   1              LCD_RW = 1;                                             //1‰∏∫‰ªé12864ËØªÂèñÔºå0‰∏∫Âêë12864ÂÜôÂÖ•
  69   1              LCD_EN = 0;
  70   1              LCD_EN = 1;
  71   1              Data_Command = LCD_DATA;
  72   1              LCD_EN = 0;
  73   1              
  74   1              return Data_Command;
  75   1      }
  76          
  77          void LCD_Write_Strs(unsigned char addr, unsigned char *str, unsigned char count){
  78   1              unsigned char i;
  79   1              LCD_Write(MODE_CMD, 0x30);
  80   1              LCD_Write(MODE_CMD, addr);      //ËÆæÂÆöDDRAMÂú∞ÂùÄ
  81   1              for(i=0; i<count; i++){ 
  82   2                      LCD_Write(MODE_DATA, str[i]);
  83   2          }
  84   1      }
  85          
  86          //Ê∏ÖÁ©∫DDRAMÊòæÁ§∫
  87          void LCD_Clear_DDRAM(){
  88   1              LCD_Write(MODE_CMD, 0x01);//Ê∏ÖÁ©∫ÊòæÁ§∫ÂëΩ‰ª§,Âç≥Â∞ÜDDRAMÂ°´Êª°20H(20HÂ∞±ÊòØÁ©∫Ê†º)
  89   1      }
  90          
  91          
  92          //Ê∏ÖÁ©∫ÁªòÂõæRAMÁöÑÂáΩÊï∞
  93          void LCD_Draw_Clear(){
  94   1              unsigned char i=0, j=0, k=0;
  95   1      
  96   1              LCD_Write(MODE_CMD, 0x34);//ÂºÄÂêØÊãìÂ±ïÊåá‰ª§ÈõÜ
  97   1              LCD_Write(MODE_CMD, 0x36);//ÂºÄÂêØGDRAMÊòæÁ§∫,,Âç≥ÊòæÁ§∫ÁªòÂõæRAM,‰∏çÊòæÁ§∫Â≠óÁ¨¶RAM
  98   1              
  99   1              //ÂàÜ‰∏ä‰∏ã‰∏§Â±èÂÜô
 100   1          for(i=0; i<2; i++){
 101   2                      //ÊØè‰∏™Â±èÊúâ32Ë°å,ÊØè‰∏™ÂçäÂ±èÈÉΩÊòØ1Âà∞32Ë°å,‰ΩÜÊòØÊ®™ÂùêÊ†á‰∏ç‰∏ÄÊ†∑
 102   2              for(j=0; j<32; j++){
 103   3                  LCD_Write(MODE_CMD, 0x80 + j);//ÂÜôYÂùêÊ†á,Âç≥ÈÄâÊã©Á¨¨Âá†Ë°å
 104   3                              //ÈÄâÊã©‰∏ä‰∏ãÂ±èÂπï
 105   3                  if(i == 0){
 106   4                      LCD_Write(MODE_CMD, 0x80);//ÈÄâÊã©‰∏äÂçäÂ±èÂπï,Ê®™ÂùêÊ†áÊòØ:0X80Âà∞0X87
 107   4                  }else{
 108   4                      LCD_Write(MODE_CMD, 0x88);//ÈÄâÊã©‰∏ãÂçäÂ±èÂπï
 109   4                  }
 110   3                              
 111   3                              //ÂÜô‰∏ÄÊï¥Ë°åÊï∞ÊçÆ
 112   3                  for(k=0; k<16; k++){
 113   4                      LCD_Write(MODE_DATA, 0x00) ;
 114   4                  }
C51 COMPILER V9.59.0.0   LCD12864                                                          12/09/2019 23:55:14 PAGE 3   

 115   3              }
 116   2              }
 117   1              
 118   1          LCD_Write(MODE_CMD, 0x30);//ÂÖ≥Èó≠Êâ©ÂÖÖÊåá‰ª§ÈõÜ
 119   1      }
 120          
 121          
 122          //Áîª‰∏Ä‰∏™ÁÇπÂáΩÊï∞
 123          void LCD_Draw_Point(unsigned char location_x, unsigned char location_y, unsigned char DrawOrClear){
 124   1              //Áîª‰∏Ä‰∏™ÁÇπÁöÑÊÄùË∑Ø:
 125   1              //È¶ñÂÖàË¶ÅÈÄâÂ•ΩË¶ÅÊòæÁ§∫ÁöÑÊòØÊòØÂì™‰∏ÄÂùóÊòæÁ§∫Âå∫Âüü
 126   1              //ÈÄâÁöÑÊñπÊ≥ïÂ∞±ÊòØÂÖàÈÄÅÂÖ•ÊòæÁ§∫Âå∫ÂüüÁöÑÁ∫µÂùêÊ†á,ÂÜçÈÄÅÂÖ•ÊòæÁ§∫Âå∫ÂüüÁöÑÊ®™ÂùêÊ†á
 127   1              
 128   1          //yÊåáÂûÇÁõ¥Âú∞ÂùÄ, xÊåáÊ∞¥Âπ≥Âú∞ÂùÄ
 129   1              unsigned char location_x_port;                                          //ÊåáÁ§∫ÂΩìÂâçÊ®™ÂùêÊ†áÁöÑÊï∞ÊçÆÂ∫îËØ•ÂÜôÂÖ•Á¨¨Âá†Âùó(ÊØè16‰Ωç‰∏ÄÂùó)
 130   1              unsigned char Point_data_old_H;                                         //Â≠òÂÇ®‰πãÂâçÂõæÁâáÁöÑÊï∞ÊçÆÁöÑÈ´òÂÖ´‰Ωç
 131   1              unsigned char Point_data_old_L;                                         //Â≠òÂÇ®‰πãÂâçÂõæÁâáÁöÑÊï∞ÊçÆÁöÑ‰ΩéÂÖ´‰Ωç
 132   1      
 133   1              LCD_Write(MODE_CMD, 0x34);                                                      //ÂºÄÂêØÊãìÂ±ïÊåá‰ª§ÈõÜ
 134   1              LCD_Write(MODE_CMD, 0x36);                                                      //ÂºÄÂêØGDRAMÊòæÁ§∫,,Âç≥ÊòæÁ§∫ÁªòÂõæRAM,‰∏çÊòæÁ§∫Â≠óÁ¨¶RAM
 135   1              
 136   1              //ÊòæÁ§∫(location_x,location_y)Ëøô‰∏™ÁÇπ
 137   1              //ÂÖàËÆ°ÁÆóÊòæÁ§∫Âå∫ÂüüÁöÑÁ∫µÂùêÊ†á(0-63)
 138   1              //ÂÖ∂‰∏≠(0-31)ÊòØ‰∏äÂçäÂ±èÂπï,(32-63)ÊòØ‰∏ãÂçäÂ±èÂπï
 139   1              
 140   1              //ËØ¥ÊòéÊòØ‰∏ãÂçäÂ±èÂπï
 141   1              //ÂÜçËÆ°ÁÆóÊòæÁ§∫Âå∫ÂüüÁöÑÊ®™ÂùêÊ†á(0-127)
 142   1              if(location_y > 31){
 143   2                      location_y %= 32;                                                       // location_y Ë¶ÅÂØπ32Âèñ‰Ωô
 144   2              }
 145   1              
 146   1              //ÂÜçËÆ°ÁÆóÊòæÁ§∫Âå∫ÂüüÁöÑÊ®™ÂùêÊ†á(0-127)
 147   1              location_x_port = location_x / 16;                              //ÂÖàËÆ°ÁÆóË¶ÅÂÜôÂÖ•Á¨¨Âá†Âùó
 148   1              
 149   1              LCD_Write(MODE_CMD, 0x80 + location_y);                 //ÊòæÁ§∫Âå∫ÂüüÁöÑÁ∫µÂùêÊ†á,Âç≥Á¨¨Âá†Ë°å
 150   1              LCD_Write(MODE_CMD, 0x88 + location_x_port);    //Ê®™ÂùêÊ†á:ÈÄâÊã©Ê®™ÂùêÊ†áÁöÑÁ¨¨Âá†Âùó
 151   1              
 152   1              //Êúâ‰∫ÜÂùêÊ†á‰πãÂêé,ÂèñÂá∫Ê≠§ÂùêÊ†áÂ§ÑÁöÑÊóßÂõæÁâáÊï∞ÊçÆ
 153   1              //Point_data_old_H = LCD_Read(1);                                       //ÂÅáËØª
 154   1              LCD_Read(1);                                                                    //ÂÅáËØª
 155   1              Point_data_old_H = LCD_Read(1);
 156   1              Point_data_old_L = LCD_Read(1);
 157   1              
 158   1              LCD_Write(MODE_CMD, 0x80 + location_y);                 //ÊòæÁ§∫Âå∫ÂüüÁöÑÁ∫µÂùêÊ†á,Âç≥Á¨¨Âá†Ë°å
 159   1              LCD_Write(MODE_CMD, 0x88 + location_x_port);    //Ê®™ÂùêÊ†á:ÈÄâÊã©Ê®™ÂùêÊ†áÁöÑÁ¨¨Âá†Âùó
 160   1              
 161   1              //‰∏äÈù¢‰πãÊâÄÊúâË¶ÅÂÜçÂÜôÂÖ•‰∏ÄÈÅçÂú∞ÂùÄ,ÊòØÂõ†‰∏∫Á¨¨‰∏ÄÊ¨°ÂÜôÂÖ•ÁöÑÊòØË¶ÅËØªÂèñÁöÑÊï∞ÊçÆÁöÑÂú∞ÂùÄ
 162   1              //Áé∞Âú®Á¨¨‰∫åÊ¨°ÂÜôÂÖ•ÁöÑÊòØË¶ÅÁªòÂà∂ÁöÑÁÇπÁöÑÂú∞ÂùÄ
 163   1      
 164   1      
 165   1              //‰∏ãÈù¢ËÆ°ÁÆóÂá∫Ë¶ÅÂêëÂ∑≤ÁªèÈÄâÂ•ΩÁöÑÊòæÁ§∫Âå∫ÂüüÂÜôÂÖ•ÁöÑÊï∞ÊçÆ
 166   1              location_x %= 16;//È¶ñÂÖà location_x Ë¶ÅÂØπ16Âèñ‰Ωô
 167   1              
 168   1              if(location_x >= 8){
 169   2                      location_x %= 8;
 170   2              }       
 171   1              //ËøôÈáåË¶ÅÂà§Êñ≠ÊòØÊì¶Èô§ÁÇπËøòÊòØÁîª‰∏Ä‰∏™ÁÇπ
 172   1              if(DrawOrClear == 1){
 173   2                      LCD_Write(MODE_DATA, Point_data_old_H);
 174   2                      LCD_Write(MODE_DATA, (Point_data_old_L) | (0X80>>location_x));// ||:Ëøô‰∏™ÊòØÈÄªËæëÊàñ  |:Ëøô‰∏™ÊâçÊòØÊå
             -â‰ΩçÊàñËøêÁÆó
 175   2              }else{
C51 COMPILER V9.59.0.0   LCD12864                                                          12/09/2019 23:55:14 PAGE 4   

 176   2                      LCD_Write(MODE_DATA, Point_data_old_H);
 177   2                      LCD_Write(MODE_DATA, (Point_data_old_L) & (~(0X80>>location_x)));
 178   2              }
 179   1              
 180   1              LCD_Write(MODE_CMD, 0x30);//ÂÖ≥Èó≠Êâ©ÂÖÖÊåá‰ª§ÈõÜ
 181   1      }
 182          
 183          //Áîª‰∏Ä‰∏™2X2ÁöÑÊ≠£ÊñπÂΩ¢ÂáΩÊï∞
 184          void LCD_Draw_Square(unsigned char location_x, unsigned char location_y, unsigned char DrawOrClear){
 185   1              LCD_Draw_Point(location_x, location_y, DrawOrClear);
 186   1              LCD_Draw_Point(location_x + 1, location_y, DrawOrClear);
 187   1              LCD_Draw_Point(location_x, location_y + 1, DrawOrClear);
 188   1              LCD_Draw_Point(location_x + 1, location_y + 1, DrawOrClear);
 189   1      }
 190          
 191          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    480    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
