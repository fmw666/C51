C51 COMPILER V9.59.0.0   LCD12864                                                          12/09/2019 23:55:14 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN .\Objects\lcd12864.obj
COMPILER INVOKED BY: D:\Keil C51\C51\BIN\C51.EXE lcd12864.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\lcd12864.lst) OBJECT(.\Objects\lcd12864.obj)

line level    source

   1          #include "lcd12864.h"
   2          #include "intrins.h"
   3          
   4          void Delay_1ms(unsigned int n){
   5   1          unsigned char i;
   6   1              unsigned char cnt = 0;
   7   1          for(i=1; i<=n; i++)
   8   1                      while(cnt < 250) 
   9   1                              cnt++;
  10   1      }
  11          
  12          //ç­‰å¾…å¿™æ ‡å¿—å‡½æ•°
  13          void LCD_Check_Busy(){
  14   1              LCD_DATA = 0xff;
  15   1              LCD_EN = 0;                             //ç¡®ä¿ä½¿èƒ½ç«¯ä¸ºä½Žç”µå¹³
  16   1              LCD_RS = 0;                             //1ä¸ºæ•°æ®ï¼Œ0ä¸ºå‘½ä»¤
  17   1              LCD_RW = 1;                             //1ä¸ºä»Ž12864è¯»å–ï¼Œ0ä¸ºå‘12864å†™å…¥
  18   1              LCD_EN = 1;
  19   1              
  20   1              while(LCD_DATA & 0x80); //å¿™çŠ¶æ€æ£€æµ‹
  21   1              LCD_EN = 0;
  22   1      }
  23          
  24          //å¹¶å£æ¨¡å¼åˆå§‹åŒ–å‡½æ•°
  25          void LCD_Init(){
  26   1              LCD_Write(MODE_CMD, 0x30);      //åŸºæœ¬æŒ‡ä»¤é›†,8ä½å¹¶è¡Œ
  27   1              LCD_Write(MODE_CMD, 0x01);      //æ¸…é™¤æ˜¾ç¤ºDDRAM
  28   1              LCD_Write(MODE_CMD, 0x06);      //å¯å§‹ç‚¹è®¾å®šï¼šå…‰æ ‡å³ç§»
  29   1              LCD_Write(MODE_CMD, 0x0C);      //æ˜¾ç¤ºçŠ¶æ€å¼€å…³ï¼šæ•´ä½“æ˜¾ç¤ºå¼€ï¼Œå…‰æ ‡æ˜¾ç¤ºå…³ï¼Œå…‰æ ‡æ˜¾ç¤ºåç™½å
             -…³
  30   1              LCD_Write(MODE_CMD, 0x02);      //åœ°å€å½’é›¶
  31   1      }
  32          
  33          //å¹¶å£å†™å…¥å‡½æ•°
  34          void LCD_Write(unsigned char Write_Mode, unsigned char Data_Command){
  35   1      /*
  36   1              LCD_Check_Busy();
  37   1              LCD_EN = 0;                                     //ç¡®ä¿ä½¿èƒ½ç«¯ä¸ºä½Žç”µå¹³
  38   1              LCD_RS = Write_Mode;            //1ä¸ºå†™å…¥æ•°æ®ï¼Œ0ä¸ºå†™å…¥å‘½ä»¤
  39   1              LCD_RW = 0;                                     //1ä¸ºä»Ž12864è¯»å–ï¼Œ0ä¸ºå‘12864å†™å…¥
  40   1              
  41   1              LCD_DATA = Data_Command;
  42   1              LCD_EN = 1;
  43   1              Delay_1ms(1);
  44   1              LCD_EN = 0;
  45   1      */
  46   1              LCD_Check_Busy();
  47   1              LCD_RS = Write_Mode;
  48   1              LCD_RW = 0;
  49   1              LCD_EN = 0;
  50   1              LCD_DATA = Data_Command;
  51   1              _nop_();
  52   1              _nop_();
  53   1              LCD_EN = 1;
C51 COMPILER V9.59.0.0   LCD12864                                                          12/09/2019 23:55:14 PAGE 2   

  54   1              _nop_();
  55   1              _nop_();
  56   1              LCD_EN = 0;
  57   1              LCD_RW = 1;
  58   1              LCD_RS = 1;
  59   1      
  60   1      }
  61          
  62          //è¯»å–RAMä¸­ç›¸åº”æ•°æ®,1ä¸ºè¯»å–æ•°æ®,0ä¸ºè¯»å–å‘½ä»¤(å³å¿™æ ‡å¿—)
  63          unsigned char LCD_Read(unsigned char Read_Mode){
  64   1              unsigned char Data_Command;
  65   1              LCD_Check_Busy();                               //ç­‰å¾…å¿™æ ‡å¿—å‡½æ•°
  66   1              LCD_DATA = 0xff;                                //ç”±äºŽIOå£æ˜¯å‡†åŒå‘,æ‰€ä»¥è¯»å–ä¹‹å‰å…ˆå†™å…¥é«˜ç”µå¹³
  67   1              LCD_RS = Read_Mode;                             //1ä¸ºè¯»å–æ•°æ®ï¼Œ0ä¸ºè¯»å–å‘½ä»¤,è¯»å‘½ä»¤è¯»çš„æ˜¯å¿™æ ‡å¿—å’Œæ­¤æ—¶å…‰æ ‡çš
             -„ä½ç½®
  68   1              LCD_RW = 1;                                             //1ä¸ºä»Ž12864è¯»å–ï¼Œ0ä¸ºå‘12864å†™å…¥
  69   1              LCD_EN = 0;
  70   1              LCD_EN = 1;
  71   1              Data_Command = LCD_DATA;
  72   1              LCD_EN = 0;
  73   1              
  74   1              return Data_Command;
  75   1      }
  76          
  77          void LCD_Write_Strs(unsigned char addr, unsigned char *str, unsigned char count){
  78   1              unsigned char i;
  79   1              LCD_Write(MODE_CMD, 0x30);
  80   1              LCD_Write(MODE_CMD, addr);      //è®¾å®šDDRAMåœ°å€
  81   1              for(i=0; i<count; i++){ 
  82   2                      LCD_Write(MODE_DATA, str[i]);
  83   2          }
  84   1      }
  85          
  86          //æ¸…ç©ºDDRAMæ˜¾ç¤º
  87          void LCD_Clear_DDRAM(){
  88   1              LCD_Write(MODE_CMD, 0x01);//æ¸…ç©ºæ˜¾ç¤ºå‘½ä»¤,å³å°†DDRAMå¡«æ»¡20H(20Hå°±æ˜¯ç©ºæ ¼)
  89   1      }
  90          
  91          
  92          //æ¸…ç©ºç»˜å›¾RAMçš„å‡½æ•°
  93          void LCD_Draw_Clear(){
  94   1              unsigned char i=0, j=0, k=0;
  95   1      
  96   1              LCD_Write(MODE_CMD, 0x34);//å¼€å¯æ‹“å±•æŒ‡ä»¤é›†
  97   1              LCD_Write(MODE_CMD, 0x36);//å¼€å¯GDRAMæ˜¾ç¤º,,å³æ˜¾ç¤ºç»˜å›¾RAM,ä¸æ˜¾ç¤ºå­—ç¬¦RAM
  98   1              
  99   1              //åˆ†ä¸Šä¸‹ä¸¤å±å†™
 100   1          for(i=0; i<2; i++){
 101   2                      //æ¯ä¸ªå±æœ‰32è¡Œ,æ¯ä¸ªåŠå±éƒ½æ˜¯1åˆ°32è¡Œ,ä½†æ˜¯æ¨ªåæ ‡ä¸ä¸€æ ·
 102   2              for(j=0; j<32; j++){
 103   3                  LCD_Write(MODE_CMD, 0x80 + j);//å†™Yåæ ‡,å³é€‰æ‹©ç¬¬å‡ è¡Œ
 104   3                              //é€‰æ‹©ä¸Šä¸‹å±å¹•
 105   3                  if(i == 0){
 106   4                      LCD_Write(MODE_CMD, 0x80);//é€‰æ‹©ä¸ŠåŠå±å¹•,æ¨ªåæ ‡æ˜¯:0X80åˆ°0X87
 107   4                  }else{
 108   4                      LCD_Write(MODE_CMD, 0x88);//é€‰æ‹©ä¸‹åŠå±å¹•
 109   4                  }
 110   3                              
 111   3                              //å†™ä¸€æ•´è¡Œæ•°æ®
 112   3                  for(k=0; k<16; k++){
 113   4                      LCD_Write(MODE_DATA, 0x00) ;
 114   4                  }
C51 COMPILER V9.59.0.0   LCD12864                                                          12/09/2019 23:55:14 PAGE 3   

 115   3              }
 116   2              }
 117   1              
 118   1          LCD_Write(MODE_CMD, 0x30);//å…³é—­æ‰©å……æŒ‡ä»¤é›†
 119   1      }
 120          
 121          
 122          //ç”»ä¸€ä¸ªç‚¹å‡½æ•°
 123          void LCD_Draw_Point(unsigned char location_x, unsigned char location_y, unsigned char DrawOrClear){
 124   1              //ç”»ä¸€ä¸ªç‚¹çš„æ€è·¯:
 125   1              //é¦–å…ˆè¦é€‰å¥½è¦æ˜¾ç¤ºçš„æ˜¯æ˜¯å“ªä¸€å—æ˜¾ç¤ºåŒºåŸŸ
 126   1              //é€‰çš„æ–¹æ³•å°±æ˜¯å…ˆé€å…¥æ˜¾ç¤ºåŒºåŸŸçš„çºµåæ ‡,å†é€å…¥æ˜¾ç¤ºåŒºåŸŸçš„æ¨ªåæ ‡
 127   1              
 128   1          //yæŒ‡åž‚ç›´åœ°å€, xæŒ‡æ°´å¹³åœ°å€
 129   1              unsigned char location_x_port;                                          //æŒ‡ç¤ºå½“å‰æ¨ªåæ ‡çš„æ•°æ®åº”è¯¥å†™å…¥ç¬¬å‡ å—(æ¯16ä½ä¸€å—)
 130   1              unsigned char Point_data_old_H;                                         //å­˜å‚¨ä¹‹å‰å›¾ç‰‡çš„æ•°æ®çš„é«˜å…«ä½
 131   1              unsigned char Point_data_old_L;                                         //å­˜å‚¨ä¹‹å‰å›¾ç‰‡çš„æ•°æ®çš„ä½Žå…«ä½
 132   1      
 133   1              LCD_Write(MODE_CMD, 0x34);                                                      //å¼€å¯æ‹“å±•æŒ‡ä»¤é›†
 134   1              LCD_Write(MODE_CMD, 0x36);                                                      //å¼€å¯GDRAMæ˜¾ç¤º,,å³æ˜¾ç¤ºç»˜å›¾RAM,ä¸æ˜¾ç¤ºå­—ç¬¦RAM
 135   1              
 136   1              //æ˜¾ç¤º(location_x,location_y)è¿™ä¸ªç‚¹
 137   1              //å…ˆè®¡ç®—æ˜¾ç¤ºåŒºåŸŸçš„çºµåæ ‡(0-63)
 138   1              //å…¶ä¸­(0-31)æ˜¯ä¸ŠåŠå±å¹•,(32-63)æ˜¯ä¸‹åŠå±å¹•
 139   1              
 140   1              //è¯´æ˜Žæ˜¯ä¸‹åŠå±å¹•
 141   1              //å†è®¡ç®—æ˜¾ç¤ºåŒºåŸŸçš„æ¨ªåæ ‡(0-127)
 142   1              if(location_y > 31){
 143   2                      location_y %= 32;                                                       // location_y è¦å¯¹32å–ä½™
 144   2              }
 145   1              
 146   1              //å†è®¡ç®—æ˜¾ç¤ºåŒºåŸŸçš„æ¨ªåæ ‡(0-127)
 147   1              location_x_port = location_x / 16;                              //å…ˆè®¡ç®—è¦å†™å…¥ç¬¬å‡ å—
 148   1              
 149   1              LCD_Write(MODE_CMD, 0x80 + location_y);                 //æ˜¾ç¤ºåŒºåŸŸçš„çºµåæ ‡,å³ç¬¬å‡ è¡Œ
 150   1              LCD_Write(MODE_CMD, 0x88 + location_x_port);    //æ¨ªåæ ‡:é€‰æ‹©æ¨ªåæ ‡çš„ç¬¬å‡ å—
 151   1              
 152   1              //æœ‰äº†åæ ‡ä¹‹åŽ,å–å‡ºæ­¤åæ ‡å¤„çš„æ—§å›¾ç‰‡æ•°æ®
 153   1              //Point_data_old_H = LCD_Read(1);                                       //å‡è¯»
 154   1              LCD_Read(1);                                                                    //å‡è¯»
 155   1              Point_data_old_H = LCD_Read(1);
 156   1              Point_data_old_L = LCD_Read(1);
 157   1              
 158   1              LCD_Write(MODE_CMD, 0x80 + location_y);                 //æ˜¾ç¤ºåŒºåŸŸçš„çºµåæ ‡,å³ç¬¬å‡ è¡Œ
 159   1              LCD_Write(MODE_CMD, 0x88 + location_x_port);    //æ¨ªåæ ‡:é€‰æ‹©æ¨ªåæ ‡çš„ç¬¬å‡ å—
 160   1              
 161   1              //ä¸Šé¢ä¹‹æ‰€æœ‰è¦å†å†™å…¥ä¸€éåœ°å€,æ˜¯å› ä¸ºç¬¬ä¸€æ¬¡å†™å…¥çš„æ˜¯è¦è¯»å–çš„æ•°æ®çš„åœ°å€
 162   1              //çŽ°åœ¨ç¬¬äºŒæ¬¡å†™å…¥çš„æ˜¯è¦ç»˜åˆ¶çš„ç‚¹çš„åœ°å€
 163   1      
 164   1      
 165   1              //ä¸‹é¢è®¡ç®—å‡ºè¦å‘å·²ç»é€‰å¥½çš„æ˜¾ç¤ºåŒºåŸŸå†™å…¥çš„æ•°æ®
 166   1              location_x %= 16;//é¦–å…ˆ location_x è¦å¯¹16å–ä½™
 167   1              
 168   1              if(location_x >= 8){
 169   2                      location_x %= 8;
 170   2              }       
 171   1              //è¿™é‡Œè¦åˆ¤æ–­æ˜¯æ“¦é™¤ç‚¹è¿˜æ˜¯ç”»ä¸€ä¸ªç‚¹
 172   1              if(DrawOrClear == 1){
 173   2                      LCD_Write(MODE_DATA, Point_data_old_H);
 174   2                      LCD_Write(MODE_DATA, (Point_data_old_L) | (0X80>>location_x));// ||:è¿™ä¸ªæ˜¯é€»è¾‘æˆ–  |:è¿™ä¸ªæ‰æ˜¯æŒ
             -‰ä½æˆ–è¿ç®—
 175   2              }else{
C51 COMPILER V9.59.0.0   LCD12864                                                          12/09/2019 23:55:14 PAGE 4   

 176   2                      LCD_Write(MODE_DATA, Point_data_old_H);
 177   2                      LCD_Write(MODE_DATA, (Point_data_old_L) & (~(0X80>>location_x)));
 178   2              }
 179   1              
 180   1              LCD_Write(MODE_CMD, 0x30);//å…³é—­æ‰©å……æŒ‡ä»¤é›†
 181   1      }
 182          
 183          //ç”»ä¸€ä¸ª2X2çš„æ­£æ–¹å½¢å‡½æ•°
 184          void LCD_Draw_Square(unsigned char location_x, unsigned char location_y, unsigned char DrawOrClear){
 185   1              LCD_Draw_Point(location_x, location_y, DrawOrClear);
 186   1              LCD_Draw_Point(location_x + 1, location_y, DrawOrClear);
 187   1              LCD_Draw_Point(location_x, location_y + 1, DrawOrClear);
 188   1              LCD_Draw_Point(location_x + 1, location_y + 1, DrawOrClear);
 189   1      }
 190          
 191          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    480    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
